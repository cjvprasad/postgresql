<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PostgreSQL Course Notes - Full Guide</title>
    <style>
        /* CSS Variables - Defaulting to Dark Theme */
        :root {
            --primary-color: #64b5f6;
            --secondary-color: #1e1e1e;
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --code-bg: #2d2d2d;
            --code-text: #f06292;
            --border-color: #444;
            --table-header-text: #121212;
            --link-hover: #42a5f5;
            --note-bg: #3e2723;
            --note-border: #ffca28;
            --note-text: #ffe082;
            
            /* Search & Highlight Colors */
            --search-bg: #333;
            --search-text: #fff;
            --highlight-color: #ffeb3b;
            --highlight-text: #000;
            --active-link-bg: rgba(100, 181, 246, 0.15);
            --active-link-border: #64b5f6;
            --header-height: 0px; /* Height of mobile header, 0 on desktop */
        }

        /* Light Theme Overrides */
        body.light-theme {
            --primary-color: #336791;
            --secondary-color: #f8f9fa;
            --bg-color: #ffffff;
            --text-color: #333;
            --code-bg: #f4f4f4;
            --code-text: #d63384;
            --border-color: #ddd;
            --table-header-text: #ffffff;
            --link-hover: #154673;
            --note-bg: #fff3cd;
            --note-border: #ffc107;
            --note-text: #856404;

            --search-bg: #ffffff;
            --search-text: #333;
            --highlight-color: #ffff00;
            --highlight-text: #000;
            --active-link-bg: #e3f2fd;
            --active-link-border: #336791;
        }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            height: 100vh;
            width: 250px;
            position: fixed;
            top: 0;
            left: 0;
            background-color: var(--secondary-color);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease, background-color 0.3s;
            z-index: 1001; /* Above content */
        }

        .search-container {
            padding: 15px;
            background-color: var(--secondary-color);
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        #searchInput {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            background-color: var(--search-bg);
            color: var(--search-text);
            box-sizing: border-box;
            outline: none;
        }
        #searchInput:focus { border-color: var(--primary-color); }

        .nav-items {
            overflow-y: auto;
            flex-grow: 1;
            padding-top: 10px;
            padding-bottom: 20px;
        }

        .sidebar a {
            padding: 10px 15px;
            text-decoration: none;
            font-size: 14px;
            color: var(--text-color);
            display: block;
            transition: all 0.2s;
            border-left: 4px solid transparent;
        }
        .sidebar a:hover {
            background-color: var(--code-bg);
            color: var(--primary-color);
        }
        .sidebar a.active {
            background-color: var(--active-link-bg);
            border-left-color: var(--active-link-border);
            color: var(--primary-color);
            font-weight: bold;
        }
        .sidebar h3 {
            padding-left: 15px;
            color: var(--primary-color);
            margin-top: 0;
        }

        /* --- MAIN CONTENT --- */
        .content {
            margin-left: 250px;
            padding: 40px;
            max-width: 900px;
            transition: margin-left 0.3s;
        }
        h1, h2, h3 { color: var(--primary-color); scroll-margin-top: 60px; }
        h1 { border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; }
        h2 { margin-top: 40px; border-bottom: 1px solid var(--border-color); padding-bottom: 5px; }

        /* Code Blocks & Tables */
        pre {
            background-color: var(--code-bg);
            border: 1px solid var(--border-color);
            border-radius: 5px;
            padding: 15px;
            overflow-x: auto; /* Allow scrolling on small screens */
        }
        code {
            font-family: 'Consolas', 'Monaco', monospace;
            color: var(--code-text);
            font-weight: bold;
        }
        pre code {
            color: var(--text-color);
            font-weight: normal;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            display: table; /* Default */
        }
        table, th, td { border: 1px solid var(--border-color); }
        th, td { padding: 10px; text-align: left; }
        th { background-color: var(--primary-color); color: var(--table-header-text); }
        
        .note {
            background-color: var(--note-bg);
            border-left: 5px solid var(--note-border);
            color: var(--note-text);
            padding: 15px;
            margin: 20px 0;
        }

        mark {
            background-color: var(--highlight-color);
            color: var(--highlight-text);
            padding: 0 2px;
            border-radius: 2px;
        }

        /* --- BUTTONS --- */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 30px;
            padding: 10px 15px;
            background-color: var(--primary-color);
            color: var(--table-header-text);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            z-index: 1002;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Mobile Menu Button (Hidden on Desktop) */
        .menu-toggle {
            display: none;
            position: fixed;
            top: 15px;
            left: 15px;
            background-color: var(--primary-color);
            color: var(--table-header-text);
            border: none;
            border-radius: 5px;
            padding: 8px 12px;
            font-size: 20px;
            cursor: pointer;
            z-index: 1003;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* Overlay for mobile sidebar */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        /* --- MEDIA QUERIES (Mobile) --- */
        @media (max-width: 768px) {
            /* Sidebar hidden by default */
            .sidebar {
                transform: translateX(-100%);
                width: 280px; /* Slightly wider for ease of use */
                box-shadow: 2px 0 10px rgba(0,0,0,0.5);
            }
            
            /* Sidebar visible state */
            .sidebar.open {
                transform: translateX(0);
            }

            .content {
                margin-left: 0;
                padding: 20px;
                padding-top: 70px; /* Space for fixed buttons */
            }

            /* Show Hamburger */
            .menu-toggle {
                display: block;
            }

            /* Adjust Theme Toggle Position */
            .theme-toggle {
                top: 15px;
                right: 15px;
                padding: 8px 12px;
                font-size: 12px;
            }

            /* Ensure tables scroll horizontally */
            table {
                display: block;
                overflow-x: auto;
                white-space: nowrap;
            }
            
            /* Show Overlay when sidebar open */
            .overlay.open {
                display: block;
            }
        }
    </style>
</head>
<body>

<button class="menu-toggle" onclick="toggleSidebar()">☰</button>

<button class="theme-toggle" id="themeToggle" onclick="toggleTheme()">☀ Switch to Light Mode</button>

<div class="overlay" id="overlay" onclick="closeSidebar()"></div>

<div class="sidebar" id="sidebar">
    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Search keywords...">
    </div>
    <div class="nav-items">
        <h3>PgSQL Guide</h3>
        <a href="#intro" class="nav-link" onclick="closeSidebar()">1. Introduction & Setup</a>
        <a href="#pgsql-vs-sql" class="nav-link" onclick="closeSidebar()">2. PostgreSQL vs SQL</a>
        <a href="#databases" class="nav-link" onclick="closeSidebar()">3. Managing Databases</a>
        <a href="#tables" class="nav-link" onclick="closeSidebar()">4. Managing Tables</a>
        <a href="#crud" class="nav-link" onclick="closeSidebar()">5. CRUD Operations</a>
        <a href="#filtering" class="nav-link" onclick="closeSidebar()">6. Filtering & Sorting</a>
        <a href="#aggregates" class="nav-link" onclick="closeSidebar()">7. Aggregates & Grouping</a>
        <a href="#logic" class="nav-link" onclick="closeSidebar()">8. Logic & Arithmetic</a>
        <a href="#constraints" class="nav-link" onclick="closeSidebar()">9. Constraints & Errors</a>
        <a href="#datetime" class="nav-link" onclick="closeSidebar()">10. Dates & Time</a>
        <a href="#relations" class="nav-link" onclick="closeSidebar()">11. Foreign Keys & Joins</a>
        <a href="#advanced" class="nav-link" onclick="closeSidebar()">12. Extensions & UUIDs</a>
        <a href="#export" class="nav-link" onclick="closeSidebar()">13. Exporting Data</a>
    </div>
</div>

<div class="content" id="mainContent">
    <h1>Complete PostgreSQL Learning Guide</h1>
    <p>Based on the "Learn PostgreSQL Tutorial - Full Course for Beginners" video. Use this document to master the command line interface (psql) and SQL concepts.</p>

    <h2 id="intro" class="section">1. Introduction & Setup</h2>
    <p>PostgreSQL (Postgres) is an advanced, open-source object-relational database system. This guide focuses on using the <code>psql</code> command-line tool rather than GUI clients, as it provides a deeper understanding of the database.</p>
    
    <h3>Key Concepts</h3>
    <ul>
        <li><strong>RDBMS:</strong> Relational Database Management System. Data is stored in tables (rows and columns).</li>
        <li><strong>SQL:</strong> Structured Query Language. The standard language to interact with databases.</li>
    </ul>

    <h3>Connecting (psql)</h3>
    <pre><code>psql -h localhost -p 5432 -U postgres -d postgres</code></pre>
    <p>Flags: <code>-h</code> (host), <code>-p</code> (port), <code>-U</code> (username), <code>-d</code> (database name).</p>
    
    <h3>Common psql Commands</h3>
    <ul>
        <li><code>\l</code> : List all databases.</li>
        <li><code>\c [dbname]</code> : Connect to a specific database.</li>
        <li><code>\d</code> : List all tables (relations) in the current database.</li>
        <li><code>\d [table_name]</code> : Describe the structure of a specific table.</li>
        <li><code>\?</code> : Help menu for psql commands.</li>
        <li><code>\q</code> : Quit/Exit psql.</li>
    </ul>

    <h2 id="pgsql-vs-sql" class="section">2. PostgreSQL vs SQL: Differences & Similarities</h2>
    <p>It is common for beginners to confuse "SQL" (the language) with "PostgreSQL" (the software).</p>

    <h3>The Distinction</h3>
    <ul>
        <li><strong>SQL (Structured Query Language):</strong> The standard language specification used to communicate with relational databases. It defines syntax like <code>SELECT</code>, <code>INSERT</code>, and <code>UPDATE</code>. Think of it as the "English language."</li>
        <li><strong>PostgreSQL:</strong> A specific database management system (software) that <em>implements</em> SQL. Think of it as a specific person who speaks English (perhaps with a specific dialect). Other systems include MySQL, SQL Server, and Oracle.</li>
    </ul>

    <h3>Similarities to other SQL Databases</h3>
    <ul>
        <li><strong>Standard SQL Support:</strong> PostgreSQL adheres very closely to the ANSI-SQL standard. If you learn SQL in Postgres, 90% of your knowledge applies to MySQL or SQL Server.</li>
        <li><strong>Relational Model:</strong> Like others, it uses Tables, Rows, Columns, Primary Keys, and Foreign Keys.</li>
        <li><strong>ACID Compliance:</strong> Ensures transactions are processed reliably (Atomicity, Consistency, Isolation, Durability).</li>
    </ul>

    <h3>Key Differences (Why choose PostgreSQL?)</h3>
    <table>
        <thead>
            <tr>
                <th>Feature</th>
                <th>PostgreSQL</th>
                <th>Standard SQL / Others (e.g., MySQL)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Extensibility</strong></td>
                <td>Highly extensible. You can define custom data types, operators, and index methods.</td>
                <td>Usually limited to built-in features.</td>
            </tr>
            <tr>
                <td><strong>Concurrency</strong></td>
                <td>Uses MVCC (Multiversion Concurrency Control). Readers don't block writers and vice versa.</td>
                <td>Often uses locking mechanisms that can cause bottlenecks in high-load scenarios.</td>
            </tr>
            <tr>
                <td><strong>Data Types</strong></td>
                <td>Advanced types: JSONB, Arrays, Geometric data, Network addresses, UUIDs.</td>
                <td>Standard types: Int, Varchar, Date. JSON support is often less robust.</td>
            </tr>
            <tr>
                <td><strong>License</strong></td>
                <td>Open Source (PostgreSQL License). Free for any use.</td>
                <td>Varies (e.g., Oracle and SQL Server are commercial/paid).</td>
            </tr>
        </tbody>
    </table>

    <h2 id="databases" class="section">3. Managing Databases</h2>
    
    <h3>Create Database</h3>
    <pre><code>CREATE DATABASE test;</code></pre>
    
    <h3>Delete Database</h3>
    <div class="note"><strong>Warning:</strong> Deleting a database is permanent and cannot be undone.</div>
    <pre><code>DROP DATABASE test;</code></pre>

    <h2 id="tables" class="section">4. Managing Tables</h2>
    
    <h3>Data Types</h3>
    <ul>
        <li><code>INT</code>, <code>BIGINT</code>: Integers.</li>
        <li><code>NUMERIC(19, 2)</code>: Decimal numbers (good for money).</li>
        <li><code>VARCHAR(n)</code>: Variable-length strings (up to n chars).</li>
        <li><code>DATE</code>: YYYY-MM-DD.</li>
        <li><code>TIMESTAMP</code>: Date + Time.</li>
        <li><code>BOOLEAN</code>: True/False.</li>
        <li><code>BIGSERIAL</code>: Auto-incrementing integer (uses a Sequence).</li>
    </ul>

    <h3>Create Table</h3>
    <pre><code>CREATE TABLE person (
    id BIGSERIAL NOT NULL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL,
    last_name VARCHAR(50) NOT NULL,
    gender VARCHAR(7) NOT NULL,
    date_of_birth DATE NOT NULL,
    email VARCHAR(150)
);</code></pre>

    <h3>Drop Table</h3>
    <pre><code>DROP TABLE person;</code></pre>

    <h2 id="crud" class="section">5. CRUD Operations</h2>
    <p>CRUD stands for Create, Read, Update, Delete.</p>

    <h3>Create (Insert)</h3>
    <pre><code>INSERT INTO person (first_name, last_name, gender, date_of_birth)
VALUES ('Anne', 'Smith', 'FEMALE', '1988-01-09');</code></pre>
    <p><em>Note: If you use BIGSERIAL for ID, you do not need to insert the ID manually.</em></p>

    <h3>Read (Select)</h3>
    <pre><code>SELECT * FROM person; -- Select all columns
SELECT first_name, last_name FROM person; -- Select specific columns</code></pre>

    <h3>Limit and Offset</h3>
    <pre><code>SELECT * FROM person LIMIT 10;
SELECT * FROM person OFFSET 5 LIMIT 5;
SELECT * FROM person OFFSET 5 FETCH FIRST 5 ROW ONLY; -- SQL Standard way</code></pre>

    <h3>Update</h3>
    <pre><code>UPDATE person 
SET email = 'new_email@gmail.com' 
WHERE id = 1;</code></pre>
    <div class="note">Always use a <code>WHERE</code> clause with UPDATE/DELETE, or you will affect every row in the table.</div>

    <h3>Delete</h3>
    <pre><code>DELETE FROM person WHERE id = 1;</code></pre>

    <h2 id="filtering" class="section">6. Filtering & Sorting</h2>

    <h3>Sorting (Order By)</h3>
    <pre><code>SELECT * FROM person ORDER BY country_of_birth ASC; -- Ascending
SELECT * FROM person ORDER BY id DESC; -- Descending</code></pre>

    <h3>Distinct Values</h3>
    <p>Remove duplicates from the result set.</p>
    <pre><code>SELECT DISTINCT country_of_birth FROM person;</code></pre>

    <h3>The WHERE Clause</h3>
    <pre><code>SELECT * FROM person WHERE gender = 'Female';
SELECT * FROM person WHERE gender = 'Male' AND country_of_birth = 'Poland';
SELECT * FROM person WHERE country_of_birth = 'Poland' OR country_of_birth = 'China';</code></pre>

    <h3>Comparison Operators</h3>
    <ul>
        <li><code>=</code> (Equal), <code>&lt;&gt;</code> (Not Equal)</li>
        <li><code>&gt;</code>, <code>&lt;</code>, <code>&gt;=</code>, <code>&lt;=</code></li>
        <li><code>IN</code>: Check if value matches any in a list.
            <pre><code>SELECT * FROM person WHERE country_of_birth IN ('China', 'Brazil', 'France');</code></pre>
        </li>
        <li><code>BETWEEN</code>: Check range.
            <pre><code>SELECT * FROM person WHERE date_of_birth BETWEEN '2000-01-01' AND '2015-01-01';</code></pre>
        </li>
        <li><code>LIKE</code>: Pattern matching (Case Sensitive). <code>%</code> is a wildcard.
            <pre><code>SELECT * FROM person WHERE email LIKE '%.com'; -- Ends with .com</code></pre>
        </li>
        <li><code>ILIKE</code>: Pattern matching (Case Insensitive).</li>
    </ul>

    <h2 id="aggregates" class="section">7. Aggregates & Grouping</h2>
    
    <h3>Functions</h3>
    <ul>
        <li><code>COUNT(*)</code>: Counts rows.</li>
        <li><code>MAX(column)</code>: Finds maximum value.</li>
        <li><code>MIN(column)</code>: Finds minimum value.</li>
        <li><code>SUM(column)</code>: Sums values.</li>
        <li><code>AVG(column)</code>: Calculates average.</li>
    </ul>

    <h3>GROUP BY</h3>
    <p>Group rows that have the same values into summary rows.</p>
    <pre><code>SELECT country_of_birth, COUNT(*) 
FROM person 
GROUP BY country_of_birth;</code></pre>

    <h3>HAVING</h3>
    <p>Filter groups after the aggregation (WHERE filters rows before grouping).</p>
    <pre><code>SELECT country_of_birth, COUNT(*) 
FROM person 
GROUP BY country_of_birth 
HAVING COUNT(*) > 5;</code></pre>

    <h2 id="logic" class="section">8. Logic & Arithmetic</h2>
    
    <h3>Arithmetic Operators</h3>
    <pre><code>SELECT 10 + 2; -- Addition
SELECT 10 - 2; -- Subtraction
SELECT 10 * 2; -- Multiplication
SELECT 10 / 2; -- Division
SELECT 10 ^ 2; -- Power
SELECT 10 % 3; -- Modulo (Remainder)</code></pre>

    <h3>COALESCE</h3>
    <p>Returns the first non-null value in a list. Useful for providing default values.</p>
    <pre><code>SELECT COALESCE(email, 'Email not provided') FROM person;</code></pre>

    <h3>NULLIF</h3>
    <p>Returns NULL if the two arguments are equal. Useful for preventing "Division by Zero" errors.</p>
    <pre><code>SELECT 10 / NULLIF(0, 0); -- Returns NULL instead of error</code></pre>

    <h2 id="constraints" class="section">9. Constraints & Error Handling</h2>
    
    <h3>Constraints</h3>
    <ul>
        <li><strong>NOT NULL:</strong> Column cannot be empty.</li>
        <li><strong>UNIQUE:</strong> All values in a column must be distinct.</li>
        <li><strong>PRIMARY KEY:</strong> Unique identifier for a row (Implies NOT NULL + UNIQUE).</li>
        <li><strong>CHECK:</strong> Ensures values meet a specific condition.</li>
    </ul>

    <h4>Adding Constraints</h4>
    <pre><code>ALTER TABLE person ADD CONSTRAINT unique_email UNIQUE (email);
ALTER TABLE person ADD CONSTRAINT gender_check CHECK (gender = 'Female' OR gender = 'Male');</code></pre>

    <h3>Handling Duplicates (ON CONFLICT)</h3>
    <pre><code>-- Do Nothing on conflict
INSERT INTO person (id, name) VALUES (1, 'John') 
ON CONFLICT (id) DO NOTHING;

-- Upsert (Update if exists)
INSERT INTO person (id, email) VALUES (1, 'new@mail.com')
ON CONFLICT (id) DO UPDATE SET email = EXCLUDED.email;</code></pre>

    <h2 id="datetime" class="section">10. Dates & Time</h2>
    
    <h3>Current Time</h3>
    <pre><code>SELECT NOW(); -- Returns timestamp with timezone
SELECT NOW()::DATE; -- Cast to date only
SELECT NOW()::TIME; -- Cast to time only</code></pre>

    <h3>Date Arithmetic</h3>
    <pre><code>SELECT NOW() - INTERVAL '1 YEAR';
SELECT NOW() + INTERVAL '10 MONTHS';</code></pre>

    <h3>Extract Fields</h3>
    <pre><code>SELECT EXTRACT(YEAR FROM NOW());
SELECT EXTRACT(MONTH FROM NOW());</code></pre>

    <h3>Age Function</h3>
    <pre><code>SELECT AGE(NOW(), date_of_birth) FROM person;</code></pre>

    <h2 id="relations" class="section">11. Foreign Keys & Joins</h2>
    
    <h3>Foreign Key Concept</h3>
    <p>A column in one table that links to the Primary Key of another table.</p>
    <pre><code>CREATE TABLE car (
    id BIGSERIAL NOT NULL PRIMARY KEY,
    make VARCHAR(100) NOT NULL,
    model VARCHAR(100) NOT NULL,
    price NUMERIC(19, 2) NOT NULL
);

CREATE TABLE person (
    -- ... other fields
    car_id BIGINT REFERENCES car(id), -- Foreign Key
    UNIQUE(car_id) -- One-to-One relationship constraint
);</code></pre>

    <h3>Joins</h3>
    <ul>
        <li><strong>INNER JOIN:</strong> Returns records that have matching values in both tables.
            <pre><code>SELECT * FROM person 
JOIN car ON person.car_id = car.id;</code></pre>
        </li>
        <li><strong>LEFT JOIN:</strong> Returns all records from the left table, and the matched records from the right table (NULL if no match).
            <pre><code>SELECT * FROM person 
LEFT JOIN car ON person.car_id = car.id;</code></pre>
        </li>
    </ul>

    <h2 id="advanced" class="section">12. Extensions & UUIDs</h2>
    
    <h3>Extensions</h3>
    <p>Postgres is extensible. You can enable features like UUID generation.</p>
    <pre><code>SELECT * FROM pg_available_extensions;
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";</code></pre>

    <h3>UUID (Universally Unique Identifier)</h3>
    <p>Better than simple integers for Primary Keys in distributed systems as they are globally unique.</p>
    <pre><code>SELECT uuid_generate_v4(); -- Generates random UUID</code></pre>
    <p><strong>Using UUID as Primary Key:</strong></p>
    <pre><code>CREATE TABLE person (
    person_uid UUID NOT NULL PRIMARY KEY,
    first_name VARCHAR(50) NOT NULL
    -- ...
);
-- Insert
INSERT INTO person (person_uid, first_name) 
VALUES (uuid_generate_v4(), 'John');</code></pre>

    <h2 id="export" class="section">13. Exporting Data</h2>
    
    <h3>Export to CSV</h3>
    <p>Use the <code>\copy</code> command inside psql to export query results to a file.</p>
    <pre><code>\copy (SELECT * FROM person LEFT JOIN car ON person.car_id = car.id) TO '/path/to/results.csv' DELIMITER ',' CSV HEADER;</code></pre>

</div>

<script>
    // --- Mobile Menu Logic ---
    function toggleSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        sidebar.classList.toggle('open');
        overlay.classList.toggle('open');
    }

    function closeSidebar() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        sidebar.classList.remove('open');
        overlay.classList.remove('open');
    }

    // --- Theme Toggle Logic ---
    function toggleTheme() {
        const body = document.body;
        const button = document.getElementById('themeToggle');
        body.classList.toggle('light-theme');
        if (body.classList.contains('light-theme')) {
            button.innerText = '☾ Switch to Dark Mode';
        } else {
            button.innerText = '☀ Switch to Light Mode';
        }
    }

    // --- Active Section (ScrollSpy) Logic ---
    const sections = document.querySelectorAll('.section');
    const navLinks = document.querySelectorAll('.nav-link');

    const observerOptions = {
        root: null,
        rootMargin: '-15% 0px -70% 0px', 
        threshold: 0
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                navLinks.forEach(link => link.classList.remove('active'));
                const id = entry.target.getAttribute('id');
                const activeLink = document.querySelector(`.sidebar a[href="#${id}"]`);
                if (activeLink) activeLink.classList.add('active');
            }
        });
    }, observerOptions);

    sections.forEach(section => observer.observe(section));

    // --- Search & Highlight Logic ---
    const searchInput = document.getElementById('searchInput');
    const contentDiv = document.getElementById('mainContent');
    const originalContent = contentDiv.innerHTML; // Store original content

    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.trim();
        contentDiv.innerHTML = originalContent; // Reset

        if (searchTerm.length < 2) {
            reAttachObserver(); // Re-bind scroll spy after DOM reset
            return;
        }

        const regex = new RegExp(`(${searchTerm})`, 'gi');
        
        function highlightText(node) {
            if (node.nodeType === 3) { // Text node
                const text = node.nodeValue;
                if (regex.test(text)) {
                    const span = document.createElement('span');
                    span.innerHTML = text.replace(regex, '<mark>$1</mark>');
                    node.parentNode.replaceChild(span, node);
                }
            } else if (node.nodeType === 1 && node.nodeName !== 'SCRIPT' && node.nodeName !== 'STYLE') {
                Array.from(node.childNodes).forEach(highlightText);
            }
        }

        highlightText(contentDiv);
        reAttachObserver(); // Re-bind scroll spy after DOM modification
    });

    function reAttachObserver() {
        const newSections = document.querySelectorAll('.section');
        newSections.forEach(section => observer.observe(section));
    }
</script>

</body>
</html>
